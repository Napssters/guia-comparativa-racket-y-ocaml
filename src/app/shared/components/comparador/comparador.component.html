<div class="flex items-center justify-center">
  <div class="relative group">
    <button
      class="rounded-full w-12 h-12 flex items-center justify-center bg-[#3e5aa9] hover:bg-[#ec690d] text-white shadow-lg transition group focus:outline-none"
      type="button" aria-label="Comparar" (click)="abrirModal()">
      <img src="assets/img/bug.png" alt="debug bug" class="w-7 h-7" />
    </button>
    <span
      class="absolute left-1/2 -translate-x-1/2 -top-10 bg-gray-900 text-white text-xs rounded px-3 py-1 opacity-0 group-hover:opacity-100 transition pointer-events-none whitespace-nowrap z-10 shadow-lg">
      Comparar
    </span>
  </div>
</div>

<div *ngIf="showModal" class="fixed inset-0 z-50 flex items-center justify-center glass-overlay overflow-y-auto p-2">
  <div class="bg-white rounded-lg shadow-lg p-6 max-w-4xl w-full relative max-h-[98vh] overflow-y-auto">
    <button (click)="cerrarModal()"
      class="absolute top-3 right-3 w-8 h-8 flex items-center justify-center rounded-full bg-[#3e5aa9] hover:bg-[#ec690d] text-white transition"
      aria-label="Cerrar modal">
      <svg class="w-4 h-4" fill="none" stroke="currentColor" stroke-width="2" viewBox="0 0 24 24">
        <path stroke-linecap="round" stroke-linejoin="round" d="M6 18L18 6M6 6l12 12" />
      </svg>
    </button>

    <div class="relative w-full mt-2">
      <div class="grid grid-cols-1 md:grid-cols-2 gap-6">
        <app-code-editor #racketEditor [label]="'Racket'" [language]="'scheme'" [code]="racketLines" [answer]="answer" [disabled]="true"
          [highlightLine]="highlightLineRacket" [showRunButton]="false" [showOutput]="mostrarOutput"
          [enableHighlight]="true"></app-code-editor>
        <app-code-editor #ocamlEditor [label]="'OCaml'" [language]="'ocaml'" [code]="ocamlLines" [answer]="answer"
          [showRunButton]="false" [disabled]="true" [highlightLine]="highlightLineOcaml" [showOutput]="mostrarOutput"
          [enableHighlight]="true"></app-code-editor>
      </div>

      <!-- Cards superpuestos, sin afectar el layout de los editores -->
      <!-- Card Explicación Racket -->
      <div *ngIf="explicacionRacket" class="absolute z-30 pointer-events-none"
        [ngStyle]="{'left': '10px', 'width': '210px', 'top': (offsetRacket || 40) + 'px'}">
        <div class="bg-blue-50 border border-blue-200 rounded-xl shadow-lg p-4 text-blue-900 text-sm w-[210px] h-[210px] overflow-y-auto pointer-events-auto flex flex-col">
          <span class="font-bold block mb-2 text-blue-700">Explicación Racket</span>
          <div class="break-words leading-relaxed flex-1">
            {{ explicacionRacket }}
          </div>
        </div>
      </div>
      <!-- Card Explicación OCaml -->
      <div *ngIf="explicacionOcaml" class="absolute z-30 pointer-events-none"
        [ngStyle]="{'right': '10px', 'width': '210px', 'top': (offsetOcaml || 40) + 'px'}">
        <div class="bg-orange-50 border border-orange-200 rounded-xl shadow-lg p-4 text-orange-900 text-sm w-[210px] h-[210px] overflow-y-auto pointer-events-auto flex flex-col">
          <span class="font-bold block mb-2 text-orange-700">Explicación OCaml</span>
          <div class="break-words leading-relaxed flex-1">
            {{ explicacionOcaml }}
          </div>
        </div>
      </div>
      <!-- Card Comparación superpuesto y rectangular -->
      <div *ngIf="explicacionComparacion" class="absolute left-1/2 -translate-x-1/2 z-40 pointer-events-none"
        [ngStyle]="{'width': '370px', 'top': (((offsetRacket + offsetOcaml) / 2) || 40) + 'px'}">
        <div class="bg-green-50 border border-green-200 rounded-xl shadow-lg p-4 text-green-900 text-sm w-[370px] h-[210px] overflow-y-auto pointer-events-auto flex flex-col">
          <span class="font-bold block mb-2 text-green-700">Comparación</span>
          <div class="break-words leading-relaxed flex-1">
            {{ explicacionComparacion }}
          </div>
        </div>
      </div>
    </div>

    <div class="sticky bottom-0 left-0 w-full flex justify-center items-center z-50 -mt-2">
      <div class="relative group mx-2">
        <button (click)="cambiarLinea(-1)" [disabled]="highlightLineRacket <= 0"
          class="rounded-full w-12 h-12 flex items-center justify-center bg-[#3e5aa9] hover:bg-[#ec690d] text-white shadow-lg transition disabled:opacity-50 disabled:cursor-not-allowed">
          <svg class="w-6 h-6" fill="none" stroke="currentColor" stroke-width="3" viewBox="0 0 24 24">
            <path stroke-linecap="round" stroke-linejoin="round" d="M15 19l-7-7 7-7" />
          </svg>
        </button>
        <span class="absolute left-1/2 -translate-x-1/2 -top-8 bg-gray-900 text-white text-xs rounded px-3 py-1 opacity-0 group-hover:opacity-100 transition pointer-events-none whitespace-nowrap z-10 shadow-lg">
          Anterior
        </span>
      </div>
      <span class="mx-4 font-bold text-lg text-[#3e5aa9] flex items-center h-12">Línea {{ highlightLineRacket + 1
        }}</span>
      <div class="relative group mx-2">
        <button (click)="cambiarLinea(1)" [disabled]="highlightLineRacket >= maxLineRacket - 1"
          class="rounded-full w-12 h-12 flex items-center justify-center bg-[#3e5aa9] hover:bg-[#ec690d] text-white shadow-lg transition disabled:opacity-50 disabled:cursor-not-allowed">
          <svg class="w-6 h-6" fill="none" stroke="currentColor" stroke-width="3" viewBox="0 0 24 24">
            <path stroke-linecap="round" stroke-linejoin="round" d="M9 5l7 7-7 7" />
          </svg>
        </button>
        <span class="absolute left-1/2 -translate-x-1/2 -top-8 bg-gray-900 text-white text-xs rounded px-3 py-1 opacity-0 group-hover:opacity-100 transition pointer-events-none whitespace-nowrap z-10 shadow-lg">
          Siguiente
        </span>
      </div>
    </div>
  </div>
</div>
